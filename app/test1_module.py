from telebot import types
import os 

# –•—Ä–∞–Ω–∏–º –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_answers = {}

def start_serials_test(bot, message):
    """
    –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞
    """
    user_id = message.chat.id
    user_answers[user_id] = {}
    
    # –®–∞–≥ 1: –í—ã–±–æ—Ä —è–∑—ã–∫–∞ —Å–µ—Ä–∏–∞–ª–∞
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    btn1 = types.InlineKeyboardButton("üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π", callback_data="step1_english")
    btn2 = types.InlineKeyboardButton("üá∑üá∫ –†—É—Å—Å–∫–∏–π", callback_data="step1_russian")
    
    markup.add(btn1, btn2)
    
    bot.send_message(
        message.chat.id,
        "üé¨ *–¢–µ—Å—Ç: –ö–∞–∫–æ–π —Å–µ—Ä–∏–∞–ª –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç?*\n\n"
        "–®–∞–≥ 1 –∏–∑ 4\n"
        "–ö–∞–∫–æ–π —è–∑—ã–∫ —Å–µ—Ä–∏–∞–ª–æ–≤ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?",
        parse_mode="Markdown",
        reply_markup=markup
    )

def step2_question(bot, call):
    """
    –®–∞–≥ 2: –í—ã–±–æ—Ä –∂–∞–Ω—Ä–∞
    """
    user_id = call.message.chat.id
    language = call.data.split("_")[1]
    user_answers[user_id]["language"] = language
    
    # –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–Ω–æ–ø–∫–∏
    bot.edit_message_text(
        chat_id=user_id,
        message_id=call.message.message_id,
        text=f"–í—ã –≤—ã–±—Ä–∞–ª–∏: {'–ê–Ω–≥–ª–∏–π—Å–∫–∏–π üá∫üá∏' if language == 'english' else '–†—É—Å—Å–∫–∏–π üá∑üá∫'}\n\n*–®–∞–≥ 2 –∏–∑ 4*\n–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä:",
        parse_mode="Markdown"
    )
    
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    if language == "english":
        btn1 = types.InlineKeyboardButton("üò± –£–∂–∞—Å—ã/–ú–∏—Å—Ç–∏–∫–∞", callback_data="step2_horror")
        btn2 = types.InlineKeyboardButton("üëª –°–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ", callback_data="step2_supernatural")
        btn3 = types.InlineKeyboardButton("üé≠ –ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –¥—Ä–∞–º–∞", callback_data="step2_teen_drama")
        btn4 = types.InlineKeyboardButton("üîÆ –§—ç–Ω—Ç–µ–∑–∏/–ó–∞–≥–∞–¥–∫–∞", callback_data="step2_fantasy")
    else:  # russian
        btn1 = types.InlineKeyboardButton("üîç –î–µ—Ç–µ–∫—Ç–∏–≤", callback_data="step2_detective")
        btn2 = types.InlineKeyboardButton("üòÇ –ö–æ–º–µ–¥–∏—è", callback_data="step2_comedy")
        btn3 = types.InlineKeyboardButton("üßõ‚Äç‚ôÇÔ∏è –ú–∏—Å—Ç–∏–∫–∞/–í–∞–º–ø–∏—Ä—ã", callback_data="step2_vampire")
        btn4 = types.InlineKeyboardButton("üé≠ –î—Ä–∞–º–∞", callback_data="step2_drama")
    
    markup.add(btn1, btn2, btn3, btn4)
    
    bot.send_message(
        user_id,
        "–ö–∞–∫–æ–π –∂–∞–Ω—Ä –≤–∞–º –±–æ–ª—å—à–µ –ø–æ –¥—É—à–µ?",
        reply_markup=markup
    )

def step3_question(bot, call):
    """
    –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
    """
    user_id = call.message.chat.id
    genre = call.data.split("_")[1]
    user_answers[user_id]["genre"] = genre
    
    bot.edit_message_text(
        chat_id=user_id,
        message_id=call.message.message_id,
        text=f"–ñ–∞–Ω—Ä –≤—ã–±—Ä–∞–Ω\n\n*–®–∞–≥ 3 –∏–∑ 4*\n–ö–∞–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É –≤–∞—Å —Å–µ–π—á–∞—Å?",
        parse_mode="Markdown"
    )
    
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    btn1 = types.InlineKeyboardButton("üòä –õ–µ–≥–∫–æ–µ/–í–µ—Å–µ–ª–æ–µ", callback_data="step3_light")
    btn2 = types.InlineKeyboardButton("üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ", callback_data="step3_neutral")
    btn3 = types.InlineKeyboardButton("üò® –ú—Ä–∞—á–Ω–æ–µ/–¢—Ä–µ–≤–æ–∂–Ω–æ–µ", callback_data="step3_dark")
    btn4 = types.InlineKeyboardButton("ü§î –ó–∞–¥—É–º—á–∏–≤–æ–µ", callback_data="step3_thoughtful")
    
    markup.add(btn1, btn2, btn3, btn4)
    
    bot.send_message(
        user_id,
        "–ö–∞–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞?",
        reply_markup=markup
    )

def step4_question(bot, call):
    """
    –®–∞–≥ 4: –í—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    """
    user_id = call.message.chat.id
    mood = call.data.split("_")[1]
    user_answers[user_id]["mood"] = mood
    
    bot.edit_message_text(
        chat_id=user_id,
        message_id=call.message.message_id,
        text=f"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ\n\n*–®–∞–≥ 4 –∏–∑ 4*\n–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –µ—Å—Ç—å?",
        parse_mode="Markdown"
    )
    
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    btn1 = types.InlineKeyboardButton("‚è± 30-40 –º–∏–Ω—É—Ç", callback_data="step4_short")
    btn2 = types.InlineKeyboardButton("‚è∞ 45-60 –º–∏–Ω—É—Ç", callback_data="step4_medium")
    btn3 = types.InlineKeyboardButton("üçø 60+ –º–∏–Ω—É—Ç", callback_data="step4_long")
    btn4 = types.InlineKeyboardButton("üì∫ –ú–∞—Ä–∞—Ñ–æ–Ω (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–∏–π)", callback_data="step4_marathon")
    
    markup.add(btn1, btn2, btn3, btn4)
    
    bot.send_message(
        user_id,
        "–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≥–æ—Ç–æ–≤—ã —É–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—É?",
        reply_markup=markup
    )

def get_series_recommendation(language, genre, mood, duration):
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–∏–∞–ª –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ —Ñ–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
    """
    # –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–µ—Ä–∏–∞–ª—ã
    if language == "english":
        if genre == "horror":
            if mood == "dark":
                return {
                    'photo_name': "ahs.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ê–ú–ï–†–ò–ö–ê–ù–°–ö–ê–Ø –ò–°–¢–û–†–ò–Ø –£–ñ–ê–°–û–í** üò±\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ê–Ω—Ç–æ–ª–æ–≥–∏—è —É–∂–∞—Å–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—é–∂–µ—Ç–∞–º–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω.\n\nüé≠ *–ñ–∞–Ω—Ä:* –£–∂–∞—Å—ã/–ú–∏—Å—Ç–∏–∫–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45-60 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –í—ã –≤—ã–±—Ä–∞–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫, –∂–∞–Ω—Ä —É–∂–∞—Å–æ–≤ –∏ –º—Ä–∞—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ - –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è AHS!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
            else:
                return {
                    'photo_name': "stranger_things.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–û–ß–ï–ù–¨ –°–¢–†–ê–ù–ù–´–ï –î–ï–õ–ê** üîÆ\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –î–µ—Ç–∏ –∏–∑ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∫–∞ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å–æ —Å–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —è–≤–ª–µ–Ω–∏—è–º–∏.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞/–£–∂–∞—Å—ã\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 50-60 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.7/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ù–æ—Å—Ç–∞–ª—å–≥–∏—è –ø–æ 80-–º, –º–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Ñ–ª–∞–∫–æ–Ω–µ!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
        
        elif genre == "supernatural":
            return {
                'photo_name': "supernatural.jpg",
                'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–°–í–ï–†–•–™–ï–°–¢–ï–°–¢–í–ï–ù–ù–û–ï** üëª\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ë—Ä–∞—Ç—å—è –í–∏–Ω—á–µ—Å—Ç–µ—Ä—ã –æ—Ö–æ—Ç—è—Ç—Å—è –Ω–∞ –Ω–µ—á–∏—Å—Ç—å –ø–æ –≤—Å–µ–π –ê–º–µ—Ä–∏–∫–µ.\n\nüé≠ *–ñ–∞–Ω—Ä:* –°–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 40-45 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.4/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –î–æ–ª–≥–∏–π —Å–µ—Ä–∏–∞–ª —Å –∞–Ω–≥–µ–ª–∞–º–∏, –¥–µ–º–æ–Ω–∞–º–∏ –∏ —Å–µ–º–µ–π–Ω—ã–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
            }
        
        elif genre == "teen_drama":
            if mood == "light":
                return {
                    'photo_name': "riverdale.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–†–ï–í–ï–†–î–ï–ô–õ** üé≠\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –¢–µ–º–Ω—ã–µ —Ç–∞–π–Ω—ã –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∫–∞ –≥–ª–∞–∑–∞–º–∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –¥—Ä–∞–º–∞/–î–µ—Ç–µ–∫—Ç–∏–≤\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 42-45 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 6.5/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ö—Ä–∞—Å–∏–≤—ã–µ –∞–∫—Ç–µ—Ä—ã, –¥—Ä–∞–º–∞ –∏ –∑–∞–≥–∞–¥–∫–∏ –≤ —Å—Ç–∏–ª—å–Ω–æ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
            else:
                return {
                    'photo_name': "euphoria.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–≠–ô–§–û–†–ò–Ø** üíä\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –û—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–π –≤–∑–≥–ª—è–¥ –Ω–∞ –∂–∏–∑–Ω—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤.\n\nüé≠ *–ñ–∞–Ω—Ä:* –î—Ä–∞–º–∞/–ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã–π\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 50-60 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.4/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –°–º–µ–ª–∞—è –¥—Ä–∞–º–∞ –æ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
        
        elif genre == "fantasy":
            return {
                'photo_name': "wednesday.jpg",
                'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–£–≠–ù–°–î–≠–ô** üßü‚Äç‚ôÄÔ∏è\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –î–æ—á—å —Å–µ–º—å–∏ –ê–¥–¥–∞–º—Å —Ä–∞—Å—Å–ª–µ–¥—É–µ—Ç —Ç–∞–π–Ω—ã –≤ —à–∫–æ–ª–µ –¥–ª—è –Ω–µ–æ–±—ã—á–Ω—ã—Ö –¥–µ—Ç–µ–π.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ö–æ–º–µ–¥–∏—è/–§—ç–Ω—Ç–µ–∑–∏/–î–µ—Ç–µ–∫—Ç–∏–≤\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45-50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.2/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ú—Ä–∞—á–Ω—ã–π —é–º–æ—Ä, –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞—è –ª–∏–Ω–∏—è –∏ –∫—É–ª—å—Ç–æ–≤–∞—è –≥–µ—Ä–æ–∏–Ω—è!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
            }
    
    # –†—É—Å—Å–∫–∏–µ —Å–µ—Ä–∏–∞–ª—ã
    else:
        if genre == "detective":
            if duration == "short":
                return {
                    'photo_name': "metod.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ú–ï–¢–û–î** üïµÔ∏è‚Äç‚ôÇÔ∏è\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ì–µ–Ω–∏–∞–ª—å–Ω—ã–π, –Ω–æ –∞—Å–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –¥–µ–ª–∞.\n\nüé≠ *–ñ–∞–Ω—Ä:* –î–µ—Ç–µ–∫—Ç–∏–≤/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45-50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.2/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤ —Å –±–ª–µ—Å—Ç—è—â–µ–π –∏–≥—Ä–æ–π –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–∞ –•–∞–±–µ–Ω—Å–∫–æ–≥–æ!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
            else:
                return {
                    'photo_name': "major.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ú–ê–ñ–û–†** üëÆ‚Äç‚ôÇÔ∏è\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –°—ã–Ω –æ–ª–∏–≥–∞—Ä—Ö–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–º –ø–æ –≤–æ–ª–µ –æ—Ç—Ü–∞.\n\nüé≠ *–ñ–∞–Ω—Ä:* –î–µ—Ç–µ–∫—Ç–∏–≤/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.3/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –î–∏–Ω–∞–º–∏—á–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤ —Å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –ø–æ–¥—Ç–µ–∫—Å—Ç–æ–º!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
        
        elif genre == "comedy":
            if mood == "light":
                return {
                    'photo_name': "interny.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ò–ù–¢–ï–†–ù–´** üè•\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ú–æ–ª–æ–¥—ã–µ –≤—Ä–∞—á–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –∏–Ω—Ç–µ—Ä–Ω–∞—Ç—É—Ä—É –ø–æ–¥ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º —Ü–∏–Ω–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ö–æ–º–µ–¥–∏—è/–°–∏—Ç–∫–æ–º\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 25 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.1/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ò–¥–µ–∞–ª—å–Ω—ã–π —Å–∏—Ç–∫–æ–º –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
            else:
                return {
                    'photo_name': "kitchen.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ö–£–•–ù–Ø** üë®‚Äçüç≥\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ñ–∏–∑–Ω—å –∏ —Ä–∞–±–æ—Ç–∞ –≤ –ø—Ä–µ—Å—Ç–∏–∂–Ω–æ–º –º–æ—Å–∫–æ–≤—Å–∫–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ö–æ–º–µ–¥–∏—è/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.1/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –°–º–µ—Å—å –∫–æ–º–µ–¥–∏–∏ –∏ –¥—Ä–∞–º—ã –æ –∂–∏–∑–Ω–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
        
        elif genre == "vampire":
            return {
                'photo_name': "vampires.jpg",
                'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–í–ê–ú–ü–ò–†–´ –°–†–ï–î–ù–ï–ô –ü–û–õ–û–°–´** üßõ‚Äç‚ôÇÔ∏è\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –°–µ–º—å—è –≤–∞–º–ø–∏—Ä–æ–≤ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–µ—Å—Ç–∏ –æ–±—ã—á–Ω—É—é –∂–∏–∑–Ω—å –≤ –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ö–æ–º–µ–¥–∏—è/–§—ç–Ω—Ç–µ–∑–∏\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 25 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 7.8/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –°–≤–µ–∂–∏–π –≤–∑–≥–ª—è–¥ –Ω–∞ –≤–∞–º–ø–∏—Ä—Å–∫—É—é —Ç–µ–º—É —Å —Ä—É—Å—Å–∫–∏–º –∫–æ–ª–æ—Ä–∏—Ç–æ–º!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
            }
        
        elif genre == "drama":
            if mood == "thoughtful":
                return {
                    'photo_name': "ippirogova.jpg",  
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–ò–ü –ü–ò–†–û–ì–û–í–ê** ‚öñÔ∏è\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ú–æ–ª–æ–¥–∞—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–∞—è —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –ò—Ä–∏–Ω–∞ –ü–∏—Ä–æ–≥–æ–≤–∞ —Ä–∞—Å—Å–ª–µ–¥—É–µ—Ç —Å–ª–æ–∂–Ω—ã–µ —É–≥–æ–ª–æ–≤–Ω—ã–µ –¥–µ–ª–∞, –±–∞–ª–∞–Ω—Å–∏—Ä—É—è –º–µ–∂–¥—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –¥–æ–ª–≥–æ–º –∏ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω—å—é.\n\nüé≠ *–ñ–∞–Ω—Ä:* –î–µ—Ç–µ–∫—Ç–∏–≤/–î—Ä–∞–º–∞/–ö—Ä–∏–º–∏–Ω–∞–ª\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45-50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.0/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –¥—Ä–∞–º–∞ —Å —Å–∏–ª—å–Ω–æ–π –∂–µ–Ω—Å–∫–æ–π –≥–ª–∞–≤–Ω–æ–π –≥–µ—Ä–æ–∏–Ω–µ–π!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
            else:
                return {
                    'photo_name': "slovo.jpg",
                    'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–°–õ–û–í–û –ü–ê–¶–ê–ù–ê. –ö–†–û–í–¨ –ù–ê –ê–°–§–ê–õ–¨–¢–ï** üëä\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–∞—è –¥—Ä–∞–º–∞ –æ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã—Ö –±–∞–Ω–¥–∞—Ö –≤ 90-—Ö –≥–æ–¥–∞—Ö.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ö—Ä–∏–º–∏–Ω–∞–ª/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 8.6/10\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –ú–æ—â–Ω–∞—è –¥—Ä–∞–º–∞ –æ –ø–æ–¥—Ä–æ—Å—Ç–∫–∞—Ö –≤ —ç–ø–æ—Ö—É –ª–∏—Ö–∏—Ö 90-—Ö!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! üçø"
                }
    
    # –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
    return {
        'photo_name': "landishi.jpg",
        'caption': "üé¨ *–í–∞–º –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:*\n\n**–õ–ê–ù–î–´–®–ò. –¢–ê–ö–ê–Ø –ù–ï–ñ–ù–ê–Ø –õ–Æ–ë–û–í–¨** üíê\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* –†–æ—Å—Å–∏–π—Å–∫–∞—è –º–µ–ª–æ–¥—Ä–∞–º–∞ 2025 –≥–æ–¥–∞ –æ –¥–≤—É—Ö —Å–µ—Ä–¥—Ü–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∫–∞–∂—É—Ç—Å—è –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.\n\nüé≠ *–ñ–∞–Ω—Ä:* –ú–µ–ª–æ–¥—Ä–∞–º–∞/–ö–æ–º–µ–¥–∏—è/–î—Ä–∞–º–∞\n‚è± *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–∏–∏:* 45-50 –º–∏–Ω—É—Ç\n‚≠ê *–†–µ–π—Ç–∏–Ω–≥:* 7.5/10 (–æ–∂–∏–¥–∞–Ω–∏–µ)\n\n‚ú® *–ü–æ—á–µ–º—É –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç:* –¢–µ–ø–ª–∞—è –∏ –¥—É—à–µ–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ –ª—é–±–≤–∏!\n\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞! ‚ù§Ô∏è"
    }

def show_final_result(bot, call):
    try:
       from db import db
       series_title = series_result['caption'].split('\n')[1].replace('**', '').strip()
       db.save_test(user_id, "–¢–µ—Å—Ç –ø–æ —Å–µ—Ä–∏–∞–ª–∞–º", series_title)
    except Exception as e:
       print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î: {e}")
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –° –§–û–¢–û
    """
    user_id = call.message.chat.id
    duration = call.data.split("_")[1]
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user_id in user_answers:
        user_answers[user_id]["duration"] = duration
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    answers = user_answers.get(user_id, {})
    language = answers.get("language", "")
    genre = answers.get("genre", "")
    mood = answers.get("mood", "")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–∏–∞–ª –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
    series_result = get_series_recommendation(language, genre, mood, duration)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î
    try:
        from db import db
        series_title = series_result['caption'].split('\n')[1].replace('**', '').strip()
        db.save_test(user_id, "–¢–µ—Å—Ç –ø–æ —Å–µ—Ä–∏–∞–ª–∞–º", series_title)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î: {e}")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.edit_message_text(
        chat_id=user_id,
        message_id=call.message.message_id,
        text="‚úÖ –í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã! –ò—â–µ–º –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–∏–∞–ª –¥–ª—è –≤–∞—Å...",
        parse_mode="Markdown"
    )
    
    # –ü—É—Ç—å –∫ —Ñ–æ—Ç–æ
    photo_path = f"photos/{series_result['photo_name']}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–æ—Ç–æ
    if os.path.exists(photo_path):
        try:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
            with open(photo_path, 'rb') as photo:
                bot.send_photo(
                    user_id,
                    photo,
                    caption=series_result['caption'],
                    parse_mode="Markdown"
                )
        except Exception as e:
            # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ: {e}")
            bot.send_message(
                user_id,
                series_result['caption'],
                parse_mode="Markdown"
            )
    else:
        # –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
        bot.send_message(
            user_id,
            series_result['caption'],
            parse_mode="Markdown"
        )
        print(f"–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: {photo_path}")
    
    # –û—á–∏—â–∞–µ–º –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user_id in user_answers:
        del user_answers[user_id]